# Webhook to Telegram Bot

Сервис для обработки входящих вебхуков и отправки уведомлений в Telegram-каналы. Позволяет получать уведомления из различных источников и маршрутизировать их в соответствующие Telegram-чаты по темам.

## Особенности

- Обработка входящих вебхуков от различных источников
- Маршрутизация сообщений по темам в разные Telegram-чаты
- Валидация входящих данных
- Гибкая настройка тем и чатов через переменные окружения
- Обработка ошибок и логирование

## Требования

- Node.js (версия 14.0.0 или выше)
- npm (версия 6.0.0 или выше)
- Telegram Bot Token (получить у [@BotFather](https://t.me/botfather))

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd tbot-hook
```

2. Установите зависимости:
```bash
npm install
```

3. Создайте файл `.env` и настройте переменные окружения:
```env
# Основные настройки
PORT=3000
TELEGRAM_BOT_TOKEN=your_bot_token_here

# Настройки маршрутизации (добавьте свои темы и ID чатов)
TELEGRAM_PATH_topic1=chat_id_1
TELEGRAM_PATH_topic2=chat_id_2:message_thread_id
```

## Запуск

Для разработки:
```bash
npm run dev
```

Для продакшена:
```bash
npm start
```

## API Endpoints

### POST /webhook/:topic

Принимает входящие вебхуки и отправляет их в соответствующий Telegram-чат.

#### Параметры URL
- `topic` - название темы (должно соответствовать настройкам в .env)

#### Тело запроса
```json
{
    "message": "Текст сообщения для отправки"
}
```

#### Ответ успешной обработки
```json
{
    "success": true,
    "message": "Webhook processed successfully"
}
```

#### Ответ с ошибкой
```json
{
    "success": false,
    "message": "Описание ошибки"
}
```

## Примеры использования

1. Отправка тестового вебхука:
```bash
curl -X POST http://localhost:3000/webhook/topic1 \
     -H "Content-Type: application/json" \
     -d '{"message": "Тестовое сообщение"}'
```

2. Настройка нового маршрута:
   - Добавьте новую переменную в `.env`:
     ```env
     TELEGRAM_PATH_new_topic=chat_id_3
     ```
   - Отправьте вебхук на новый маршрут:
     ```bash
     curl -X POST http://localhost:3000/webhook/new_topic \
          -H "Content-Type: application/json" \
          -d '{"message": "Сообщение для новой темы"}'
     ```

## Разработка

### Добавление новой темы

1. Добавьте новую переменную окружения в формате:
```env
TELEGRAM_PATH_your_topic=your_chat_id
```

2. Перезапустите сервер

### Валидация

Сервис автоматически проверяет:
- Наличие обязательных полей
- Корректность типов данных
- Существование указанной темы
- Наличие настроек для темы

## Логирование

Все ошибки логируются в консоль. В продакшене рекомендуется настроить внешнее логирование.

## Безопасность

- Храните `TELEGRAM_BOT_TOKEN` в безопасном месте
- Используйте HTTPS в продакшене
- Рассмотрите возможность добавления аутентификации для вебхуков

## Лицензия

MIT

## Поддержка

При возникновении проблем создайте issue в репозитории проекта.

